# WebRTC è¢å¹•æ•æ‰è¨­ç½®æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—èªªæ˜å¦‚ä½•è¨­ç½®å’Œä½¿ç”¨ WebRTC è¢å¹•æ•æ‰åŠŸèƒ½ï¼ŒåŒ…æ‹¬ Railway é™åˆ¶ã€æ•…éšœæ’é™¤å’Œæ€§èƒ½å„ªåŒ–ã€‚

## ğŸ—ï¸ æ¶æ§‹èªªæ˜

### å‚³è¼¸æ¨¡å¼

1. **WebRTC P2Pï¼ˆå„ªå…ˆï¼‰**
   - é»å°é»ç›´é€£ï¼Œå»¶é²æœ€ä½ï¼ˆ100-300msï¼‰
   - ä½¿ç”¨ STUN ä¼ºæœå™¨é€²è¡Œ NAT ç©¿é€
   - è‡ªå‹•é©æ‡‰ç¶²è·¯æ¢ä»¶å’Œå“è³ª

2. **WebSocket ä¸­ç¹¼ï¼ˆé™ç´šï¼‰**
   - é€šé Railway ä¼ºæœå™¨ä¸­ç¹¼
   - å»¶é²è¼ƒé«˜ï¼ˆ500-1000msï¼‰
   - ç¢ºä¿ 100% å¯ç”¨æ€§

### é€£æ¥æµç¨‹

```
é›»è…¦ç€è¦½å™¨ â†’ Railway WebSocketï¼ˆä¿¡ä»¤ï¼‰ â†’ Unity
     â†“
WebRTC P2P é€£æ¥å»ºç«‹
     â†“
ç›´æ¥è¦–é »æµå‚³è¼¸ï¼ˆä¸ç¶“é Railwayï¼‰
```

## âš ï¸ Railway é™åˆ¶

### é‡è¦é™åˆ¶

- **åƒ…æ”¯æ´ WebSocketï¼ˆTCPï¼‰**ï¼šç„¡æ³•æä¾› UDP æœå‹™
- **ç„¡æ³•ä½œç‚º TURN ä¼ºæœå™¨**ï¼šä¸èƒ½ä¸­ç¹¼ WebRTC åª’é«”æµ
- **åƒ…ç”¨æ–¼ä¿¡ä»¤äº¤æ›**ï¼šoffer/answer/ice-candidate æ¶ˆæ¯

### å½±éŸ¿

- è·¨ç¶²è·¯é€£æ¥æˆåŠŸç‡å—é™ï¼ˆ30-50%ï¼‰
- éœ€è¦è‡³å°‘ä¸€æ–¹æœ‰å…¬ç¶² IP æˆ–å‹å¥½çš„ NAT é¡å‹
- åŒç¶²è·¯å…§é€£æ¥æˆåŠŸç‡è¼ƒé«˜ï¼ˆ95%+ï¼‰

## ğŸ”§ è¨­ç½®æ­¥é©Ÿ

### 1. Unity è¨­ç½®

#### å®‰è£ WebRTC å¥—ä»¶
1. æ‰“é–‹ Unity Package Manager
2. æœç´¢ "WebRTC"
3. å®‰è£ `com.unity.webrtc` å¥—ä»¶ï¼ˆå»ºè­°ç‰ˆæœ¬ 3.0.0+ï¼‰

#### å ´æ™¯è¨­ç½®
1. å‰µå»ºç©º GameObject
2. æ·»åŠ  `WebRTCScreenReceiver` çµ„ä»¶
3. è¨­ç½® `targetRenderer` æŒ‡å‘è¦é¡¯ç¤ºè¦–é »çš„ç‰©ä»¶
4. ç¢ºä¿ `GyroscopeReceiver` å­˜åœ¨æ–¼å ´æ™¯ä¸­

### 2. å‰ç«¯è¨­ç½®

#### ç€è¦½å™¨è¦æ±‚
- Chrome 80+ï¼ˆæ¨è–¦ï¼‰
- Firefox 75+
- Safari 13+ï¼ˆéƒ¨åˆ†åŠŸèƒ½å—é™ï¼‰
- Edge 80+

#### æ¬Šé™è¨­ç½®
- è¢å¹•æ•ç²æ¬Šé™
- è‡ªå‹•å…è¨±ï¼ˆæˆ–æ‰‹å‹•å…è¨±ï¼‰

### 3. ä¼ºæœå™¨è¨­ç½®

#### Railway éƒ¨ç½²
```bash
# éƒ¨ç½²åˆ° Railway
git add .
git commit -m "Add WebRTC signaling support"
git push origin main
```

#### ç’°å¢ƒè®Šæ•¸
ç„¡éœ€é¡å¤–ç’°å¢ƒè®Šæ•¸ï¼Œä½¿ç”¨é è¨­ STUN ä¼ºæœå™¨ã€‚

## ğŸ“Š æ€§èƒ½ç›£æ§

### å‰ç«¯ç›£æ§æŒ‡æ¨™

| æŒ‡æ¨™ | èªªæ˜ | æ­£å¸¸ç¯„åœ |
|------|------|----------|
| ä½å…ƒç‡ | è¦–é »å‚³è¼¸é€Ÿç‡ | 500-2000 kbps |
| å¹€ç‡ | è¦–é »å¹€ç‡ | 15-30 fps |
| RTT | å¾€è¿”å»¶é² | 50-300 ms |
| å€™é¸è€…é¡å‹ | é€£æ¥é¡å‹ | host/srflx/relay |

### Unity ç›£æ§

åœ¨ Scene è¦–åœ–ä¸­æŸ¥çœ‹ï¼š
- ICE é€£æ¥ç‹€æ…‹
- PeerConnection ç‹€æ…‹
- è¦–é »è§£æåº¦

## ğŸ› æ•…éšœæ’é™¤

### å¸¸è¦‹å•é¡Œ

#### 1. é»‘ç•«é¢å•é¡Œ
**ç—‡ç‹€**ï¼šUnity æ”¶åˆ°ä¿¡ä»¤ä½†æ²’æœ‰è¦–é »é¡¯ç¤º

**å¯èƒ½åŸå› **ï¼š
- WebRTC P2P é€£æ¥å¤±æ•—
- è¦–é »è»Œé“æœªæ­£ç¢ºæ¥æ”¶
- VideoRenderer æœªæ­£ç¢ºè¨­ç½®

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
1. æª¢æŸ¥ Console æ—¥èªŒä¸­çš„ ICE ç‹€æ…‹
2. ç¢ºèªå€™é¸è€…é¡å‹ï¼ˆæ‡‰ç‚º host æˆ– srflxï¼‰
3. æª¢æŸ¥ Unity ä¸­çš„ WebRTC ç‹€æ…‹é¡¯ç¤º

#### 2. åªåŒç¶²è·¯å¯ç”¨
**ç—‡ç‹€**ï¼šåŒä¸€ç¶²è·¯å…§æ­£å¸¸ï¼Œè·¨ç¶²è·¯å¤±æ•—

**åŸå› **ï¼šç¼ºå°‘ TURN ä¼ºæœå™¨

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨å¤–éƒ¨ TURN æœå‹™ï¼ˆå¦‚ coturnï¼‰
- æˆ–æ¥å— WebSocket é™ç´šæ¨¡å¼

#### 3. 18ç§’è¶…æ™‚é™ç´š
**ç—‡ç‹€**ï¼šWebRTC é€£æ¥è¶…æ™‚ï¼Œè‡ªå‹•åˆ‡æ›åˆ° WebSocket

**åŸå› **ï¼šNAT é¡å‹ä¸å‹å¥½æˆ–ç¶²è·¯é™åˆ¶

**è§£æ±ºæ–¹æ¡ˆ**ï¼š
- æª¢æŸ¥é˜²ç«ç‰†è¨­ç½®
- å˜—è©¦ä¸åŒçš„ç¶²è·¯ç’°å¢ƒ
- ä½¿ç”¨ WebSocket æ¨¡å¼ï¼ˆåŠŸèƒ½æ­£å¸¸ï¼‰

#### 4. ä¿¡ä»¤é€£æ¥å¤±æ•—
**ç—‡ç‹€**ï¼šç„¡æ³•å»ºç«‹ WebRTC é€£æ¥

**æª¢æŸ¥é …ç›®**ï¼š
1. Railway ä¼ºæœå™¨æ˜¯å¦é‹è¡Œ
2. WebSocket é€£æ¥æ˜¯å¦æ­£å¸¸
3. æˆ¿é–“ ID æ˜¯å¦åŒ¹é…
4. è§’è‰²è¨»å†Šæ˜¯å¦æˆåŠŸ

### èª¿è©¦æ­¥é©Ÿ

#### 1. æª¢æŸ¥ä¿¡ä»¤æµç¨‹
```javascript
// åœ¨ç€è¦½å™¨ Console ä¸­
console.log('WebRTC æ”¯æ´:', !!window.RTCPeerConnection);
console.log('WebSocket ç‹€æ…‹:', gyroWS.ws.readyState);
```

#### 2. æª¢æŸ¥ ICE å€™é¸è€…
```javascript
// æŸ¥çœ‹å€™é¸è€…é¡å‹
peerConnection.onicecandidate = (event) => {
    if (event.candidate) {
        console.log('ICE å€™é¸è€…:', event.candidate.candidate);
    }
};
```

#### 3. Unity èª¿è©¦
- å•Ÿç”¨ `showDebugInfo` é¸é …
- æŸ¥çœ‹ Console ä¸­çš„ WebRTC ç‹€æ…‹
- æª¢æŸ¥ `WebRTCScreenReceiver` çµ„ä»¶ç‹€æ…‹

## ğŸš€ æ€§èƒ½å„ªåŒ–

### è¦–é »å“è³ªèª¿æ•´

#### å‰ç«¯è¨­ç½®
```javascript
// èª¿æ•´è¦–é »åƒæ•¸
const constraints = {
    video: {
        width: { ideal: 1280, max: 1920 },
        height: { ideal: 720, max: 1080 },
        frameRate: { ideal: 30, max: 60 }
    }
};

// è¨­ç½® contentHint
videoTrack.contentHint = 'text'; // æ–‡å­—æ¸…æ™°
// æˆ–
videoTrack.contentHint = 'motion'; // å‹•æ…‹å…§å®¹
```

#### Unity è¨­ç½®
- ä½¿ç”¨ `VideoRenderer` è€Œéç›´æ¥æ“ä½œ Texture
- é¿å…æ¯å¹€é‡å»ºæè³ª
- è¨­ç½®é©ç•¶çš„ RenderTexture å°ºå¯¸

### ç¶²è·¯å„ªåŒ–

#### STUN ä¼ºæœå™¨é…ç½®
```javascript
const rtcConfig = {
    iceServers: [
        { urls: 'stun:stun.l.google.com:19302' },
        { urls: 'stun:stun1.l.google.com:19302' },
        { urls: 'stun:stun2.l.google.com:19302' }
    ],
    iceCandidatePoolSize: 10
};
```

#### å¯é¸ï¼šTURN ä¼ºæœå™¨
```javascript
// ä½¿ç”¨å¤–éƒ¨ TURN æœå‹™
const rtcConfig = {
    iceServers: [
        { urls: 'stun:stun.l.google.com:19302' },
        { 
            urls: 'turn:your-turn-server.com:3478',
            username: 'your-username',
            credential: 'your-password'
        }
    ]
};
```

## ğŸ“ˆ æˆåŠŸç‡é æœŸ

### é€£æ¥æˆåŠŸç‡

| ç¶²è·¯ç’°å¢ƒ | WebRTC æˆåŠŸç‡ | èªªæ˜ |
|----------|---------------|------|
| åŒä¸€ç¶²è·¯ | 95%+ | ä½¿ç”¨ host candidates |
| ä¸€æ–¹å…¬ç¶² IP | 70-80% | ä½¿ç”¨ srflx candidates |
| é›™ NAT | 30-50% | éœ€è¦ TURN ä¼ºæœå™¨ |
| ä¼æ¥­é˜²ç«ç‰† | 10-30% | å¯èƒ½å®Œå…¨é˜»æ“‹ |

### é™ç´šç­–ç•¥

- **10ç§’è¶…æ™‚**ï¼šå˜—è©¦ `restartIce()`
- **18ç§’è¶…æ™‚**ï¼šé™ç´šåˆ° WebSocket
- **è‡ªå‹•é‡è©¦**ï¼šWebSocket æ¨¡å¼ç¢ºä¿åŠŸèƒ½å¯ç”¨

## ğŸ”® æœªä¾†æ”¹é€²

### çŸ­æœŸæ”¹é€²
- æ‰‹å‹•æ¨¡å¼åˆ‡æ›æŒ‰éˆ•
- æ›´è©³ç´°çš„ç‹€æ…‹ç›£æ§
- é€£æ¥å“è³ªæŒ‡ç¤ºå™¨

### é•·æœŸæ”¹é€²
- æ•´åˆ TURN ä¼ºæœå™¨ï¼ˆæå‡è·¨ NAT æˆåŠŸç‡ï¼‰
- è¦–é »å“è³ªè‡ªé©æ‡‰ç®—æ³•
- å¤šæˆ¿é–“æ”¯æ´
- å®‰å…¨ token é©—è­‰

## ğŸ“š åƒè€ƒè³‡æº

- [WebRTC å®˜æ–¹æ–‡æª”](https://webrtc.org/)
- [Unity WebRTC å¥—ä»¶](https://docs.unity3d.com/Packages/com.unity.webrtc@latest/)
- [STUN/TURN ä¼ºæœå™¨è¨­ç½®](https://github.com/coturn/coturn)
- [Railway å¹³å°é™åˆ¶](https://docs.railway.app/)

## ğŸ†˜ æ”¯æ´

å¦‚é‡åˆ°å•é¡Œï¼Œè«‹æª¢æŸ¥ï¼š
1. ç€è¦½å™¨ Console æ—¥èªŒ
2. Unity Console æ—¥èªŒ
3. Railway ä¼ºæœå™¨ç‹€æ…‹
4. ç¶²è·¯é€£æ¥ç‹€æ³

å¸¸è¦‹å•é¡Œè«‹åƒè€ƒä¸Šè¿°æ•…éšœæ’é™¤ç« ç¯€ã€‚
